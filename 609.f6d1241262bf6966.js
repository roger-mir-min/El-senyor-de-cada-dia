"use strict";(self.webpackChunkelsenyorde=self.webpackChunkelsenyorde||[]).push([[609],{2609:(T,m,u)=>{u.r(m),u.d(m,{RutesModule:()=>M});var c=u(6814),d=u(6538),t=u(4946),g=u(8433),a=u(95),p=u(2491);const h=[{name:"Casa - Canalla",puntuacio:7,descripcio:"c\xe8ntric, massa gent a la Rambla",default:!0,coords:[{lat:41.53813345637528,lng:2.104633444520165},{lat:41.53935296832536,lng:2.1050502899781494},{lat:41.54109077635059,lng:2.111680494982252},{lat:41.546591313357396,lng:2.1089553706324407},{lat:41.54662343190692,lng:2.1089231841244414},{lat:41.546816142869076,lng:2.1086764208964457},{lat:41.546844193630335,lng:2.108395095751984}]}];let f=(()=>{class r{constructor(){this.rutesArray=(0,t.tdS)([]),this.rutesArray.set(this.getInitialArray()),(0,t.cEC)(()=>{localStorage.setItem("elsenyor-rutes",JSON.stringify(this.rutesArray())),console.log("s'ha guardat localstorage")})}getInitialArray(){return localStorage.getItem("elsenyor-rutes")&&JSON.parse(localStorage.getItem("elsenyor-rutes")).length>0?JSON.parse(localStorage.getItem("elsenyor-rutes")):h}addRuta(e){this.rutesArray.mutate(n=>n.push(e))}deleteRutaFromArr(e){this.rutesArray.update(n=>[...n.filter(o=>o.name!==e)])}deleteAllRutes(){this.rutesArray.update(e=>[]),localStorage.removeItem("elsenyor-rutes")}changeFav(e,n){this.deleteRutaFromArr(e.name),this.rutesArray.mutate(o=>o.push({name:e.name,coords:e.coords,descripcio:e.descripcio,puntuacio:e.puntuacio,default:e.default,fav:n}))}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();function _(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.enableAddPuntsOfRutaArray())}),t._uU(1," Afegeix una ruta "),t.qZA()}}function x(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"div"),t._uU(2),t.qZA(),t.BQk()),2&r){const e=i.$implicit;t.xp6(2),t.AsE("",e.lat,", ",e.lng,"")}}function v(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",0),t._uU(2,"Punts afegits (m\xednim 2):"),t.qZA(),t.YNc(3,x,3,2,"ng-container",8),t.TgZ(4,"form",12),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.submitForm())}),t.TgZ(5,"div")(6,"label",13),t._uU(7,"Nom"),t.qZA(),t._UZ(8,"input",14),t.TgZ(9,"label",15),t._uU(10,"Puntuaci\xf3"),t.qZA(),t._UZ(11,"input",16),t.qZA(),t.TgZ(12,"div")(13,"label",17),t._uU(14,"Descripci\xf3"),t.qZA(),t._UZ(15,"input",18),t.TgZ(16,"label",19),t._uU(17,"Favorit"),t.qZA(),t._UZ(18,"input",20),t.qZA(),t.TgZ(19,"button",21),t._uU(20," Crea la ruta "),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.currentCoords),t.xp6(1),t.Q6J("formGroup",e.rutaForm),t.xp6(4),t.ekj("is-invalid",e.rutaForm.get("inputNom").invalid&&e.rutaForm.get("inputNom").touched),t.xp6(3),t.ekj("is-invalid",e.rutaForm.get("inputPuntuacio").invalid&&e.rutaForm.get("inputPuntuacio").touched),t.xp6(4),t.ekj("is-invalid",e.rutaForm.get("inputPuntuacio").invalid&&e.rutaForm.get("inputPuntuacio").touched),t.xp6(4),t.Q6J("disabled",2>e.currentCoords.length)}}function A(r,i){1&r&&(t.TgZ(0,"small",32),t._uU(1,"Default point"),t.qZA())}function y(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"i",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,s=t.oxw();return t.KtG(s.changeFav(o,!1))}),t.qZA()}}function b(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"i",34),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,s=t.oxw();return t.KtG(s.changeFav(o,!0))}),t.qZA()}}function C(r,i){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",22)(2,"div",23)(3,"img",24),t.NdJ("click",function(){const s=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.centerMap(s.coords[0].lat,s.coords[0].lng))}),t.qZA(),t.TgZ(4,"div",25)(5,"div",26)(6,"b"),t._uU(7),t.qZA()(),t.TgZ(8,"div",2)(9,"b"),t._uU(10,"Descripci\xf3"),t.qZA(),t._uU(11),t.qZA(),t.TgZ(12,"div",2)(13,"b"),t._uU(14,"Puntuaci\xf3"),t.qZA(),t._uU(15),t.qZA()(),t.YNc(16,A,2,0,"small",27),t.YNc(17,y,1,0,"i",28),t.YNc(18,b,1,0,"i",29),t.TgZ(19,"div",30)(20,"button",31),t.NdJ("click",function(){const s=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.deleteRuta(s.name))}),t._uU(21," Elimina "),t.qZA()()()(),t.BQk()}if(2&r){const e=i.$implicit,n=i.index;t.xp6(2),t.Q6J("id","card-"+n),t.xp6(1),t.Q6J("src","https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/pin-s("+e.coords[0].lng+","+e.coords[0].lat+")/"+e.coords[0].lng+","+e.coords[0].lat+",14/500x300?access_token=pk.eyJ1Ijoicm9nZXItbWlyLW1pbiIsImEiOiJjbGoxbmR5cmgwc2EzM25veG12MmpsMzFsIn0._AGFhRr_UiAPltvxQ2ztiQ",t.LSH),t.xp6(4),t.Oqu(e.name),t.xp6(4),t.hij(": ",e.descripcio," "),t.xp6(4),t.hij(": ",e.puntuacio," "),t.xp6(1),t.Q6J("ngIf",1==e.default),t.xp6(1),t.Q6J("ngIf",1==e.fav&&0==e.default),t.xp6(1),t.Q6J("ngIf",0==e.fav&&0==e.default)}}let R=(()=>{class r{constructor(e,n,o,s){this.fb=e,this.rutesService=n,this.renderer=o,this.el=s,this.rutesArray=(0,t.tdS)([]),this.showArray=!1,this.currentCoords=[],this.resetMapAfterRutesArrayUpdate=(0,t.cEC)(()=>{this.rutesArray()&&this.map&&(this.map.eachLayer(l=>{this.map.removeLayer(l)}),(0,p._6)(this.map),this.addRutesToMap())}),this.rutesArray=this.rutesService.rutesArray,this.rutaForm=this.fb.group({inputNom:["",[a.kI.required]],inputPuntuacio:[0,[a.kI.required]],inputDescripcio:["",[a.kI.required]],inputFav:!1})}submitForm(){const e=this.rutaForm.value;this.rutesService.addRuta({name:e.inputNom,coords:this.currentCoords,descripcio:e.inputDescripcio,puntuacio:e.inputPuntuacio,default:!1,fav:e.inputFav}),this.showArray=!1}ngOnInit(){console.log("Map-rutes component initilized")}ngAfterViewInit(){this.map=(0,p.ip)("map"),(0,p._6)(this.map),this.addRutesToMap(),this.map.on("click",e=>{const n=e.latlng.lat,o=e.latlng.lng;if(1==this.showArray){this.currentCoords.push({lat:n,lng:o});let s=(0,g.marker)([n,o]).addTo(this.map);s.on("click",()=>{this.map.removeLayer(s),this.currentCoords=[...this.currentCoords.filter(l=>l.lat!==n&&l.lng!==o)]})}})}addRutesToMap(){this.rutesArray().map(e=>{const n=(0,g.polyline)(e.coords,{color:this.getRandomColor()}).bindPopup(`${e.name}`).addTo(this.map);n.on("click",()=>n.openPopup()),n.on("popupopen",()=>this.highlightCard({selectedRuta:e,highlight:!0})),n.on("popupclose",()=>this.highlightCard({selectedRuta:e,highlight:!1}))})}enableAddPuntsOfRutaArray(){this.showArray=!0}deleteRuta(e){this.rutesService.deleteRutaFromArr(e)}deleteAllRutes(){this.rutesService.deleteAllRutes()}changeFav(e,n){this.rutesService.changeFav(e,n)}highlightCard(e){this.rutesArray().forEach((n,o)=>{e.selectedRuta.name==n.name&&e.selectedRuta.coords[0].lng==n.coords[0].lng&&e.selectedRuta.coords[0].lat==n.coords[0].lat&&(this.highlightedCard=this.el.nativeElement.querySelector(`#card-${o}`),this.renderer.setStyle(this.highlightedCard,"border",1==e.highlight?"1px solid black":"none"))})}getRandomColor(){const e=10*Math.random();return e>9?"blue":e>8?"purple":e>7?"red":e>6?"pink":e>5?"brown":e>4?"green":e>3?"black":e>2?"orange":e>2?"grey":"yellow"}centerMap(e,n){(0,p.up)(e,n,this.map)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(a.qu),t.Y36(f),t.Y36(t.Qsj),t.Y36(t.SBq))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-map-rutes"]],decls:18,vars:3,consts:[[1,"fw-bold"],[1,"mb-5"],[1,"text-crimson"],["id","map",1,"mb-3"],["class","btn btn-dark",3,"click",4,"ngIf"],["class","my-4 text-crimson",4,"ngIf"],[1,"punts-wrapper"],[1,"row","g-0",2,"margin","0 -16px 0 -16px"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger","mx-auto","mt-4","text-crimson",2,"max-width","40%",3,"click"],[1,"btn","btn-dark",3,"click"],[1,"my-4","text-crimson"],[3,"formGroup","ngSubmit"],["for","nom",1,"me-2"],["id","nom","type","text","placeholder","nom","formControlName","inputNom",1,"me-2","me-md-3","mb-3"],["for","puntuaci\xf3",1,"me-2"],["id","puntuaci\xf3","type","number","formControlName","inputPuntuacio",1,"me-2","me-md-3","mb-3"],["for","descripci\xf3",1,"me-2"],["id","descripci\xf3","tpye","text","formControlName","inputDescripcio",1,"me-2","me-md-3","mb-3"],["for","fav",1,"me-2"],["id","fav","type","checkbox","formControlName","inputFav",1,"me-2","me-md-3","mb-3"],["type","submit",1,"btn","btn-dark",3,"disabled"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","p-3"],[1,"card","text-center","h-100",2,"position","relative",3,"id"],["alt","mapet",1,"cursor-pointer",3,"src","click"],[1,"card-body"],[1,""],["style","position: absolute; top: 12px; right: 12px",4,"ngIf"],["class","fa-solid fa-star","style","position: absolute; top: 12px; right: 12px",3,"click",4,"ngIf"],["class","fa-regular fa-star","style","position: absolute; top: 12px; right: 12px",3,"click",4,"ngIf"],[1,"card-footer"],[1,"btn","btn-outline-danger","text-crimson",3,"click"],[2,"position","absolute","top","12px","right","12px"],[1,"fa-solid","fa-star",2,"position","absolute","top","12px","right","12px",3,"click"],[1,"fa-regular","fa-star",2,"position","absolute","top","12px","right","12px",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Les meves rutes"),t.qZA(),t.TgZ(2,"section",1)(3,"h3",2),t._uU(4,"Mapa de rutes guardades"),t.qZA(),t.TgZ(5,"p",2),t._uU(6,' Clica el bot\xf3 "Afegeix una ruta", i a continuaci\xf3 clica al mapa als punts de la ruta, per ordre. Posa un punt per cada canvi de direcci\xf3 de la ruta. Completa la informaci\xf3 de la ruta que apareix sota el mapa i clica "Crea la ruta". Veur\xe0s que es dibuixa la ruta al mapa i que s\'afegeix la targeta de la nova ruta a la col\xb7lecci\xf3 de baix. Les dues primeres targetes hi s\xf3n per defecte, les pots eliminar. '),t.qZA(),t._UZ(7,"div",3),t.YNc(8,_,2,0,"button",4),t.YNc(9,v,21,9,"div",5),t.qZA(),t.TgZ(10,"section")(11,"div",6)(12,"h3",2),t._uU(13,"Col\xb7lecci\xf3 de rutes guardades"),t.qZA(),t.TgZ(14,"div",7),t.YNc(15,C,22,8,"ng-container",8),t.qZA(),t.TgZ(16,"button",9),t.NdJ("click",function(){return n.deleteAllRutes()}),t._uU(17," Eliminar totes les rutes "),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("ngIf",0==n.showArray),t.xp6(1),t.Q6J("ngIf",1==n.showArray),t.xp6(6),t.Q6J("ngForOf",n.rutesArray()))},dependencies:[c.sg,c.O5,a._Y,a.Fj,a.wV,a.Wl,a.JJ,a.JL,a.sg,a.u],styles:["#map[_ngcontent-%COMP%]{height:600px}"]}),r})();const Z=[{path:"",component:(()=>{class r{constructor(){}ngOnInit(){}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-rutes"]],decls:1,vars:0,template:function(e,n){1&e&&t._UZ(0,"app-map-rutes")},dependencies:[R]}),r})()}];let F=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[d.Bz.forChild(Z),c.ez,d.Bz,a.UX]}),r})(),M=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({providers:[f],imports:[c.ez,F]}),r})()}}]);