"use strict";(self.webpackChunkelsenyorde=self.webpackChunkelsenyorde||[]).push([[872],{3872:(T,m,c)=>{c.r(m),c.d(m,{RUTES_ROUTES:()=>Z});var t=c(4946),d=c(8433),u=c(95),l=c(2491),p=c(6814);const g=[{name:"Casa - Canalla",puntuacio:7,descripcio:"c\xe8ntric, massa gent a la Rambla",default:!0,coords:[{lat:41.53813345637528,lng:2.104633444520165},{lat:41.53935296832536,lng:2.1050502899781494},{lat:41.54109077635059,lng:2.111680494982252},{lat:41.546591313357396,lng:2.1089553706324407},{lat:41.54662343190692,lng:2.1089231841244414},{lat:41.546816142869076,lng:2.1086764208964457},{lat:41.546844193630335,lng:2.108395095751984}]}];let f=(()=>{class n{constructor(){this.rutesArray=(0,t.tdS)([]),this.rutesArray.set(this.getInitialArray()),(0,t.cEC)(()=>{localStorage.setItem("elsenyor-rutes",JSON.stringify(this.rutesArray())),console.log("s'ha guardat localstorage")})}getInitialArray(){return localStorage.getItem("elsenyor-rutes")&&JSON.parse(localStorage.getItem("elsenyor-rutes")).length>0?JSON.parse(localStorage.getItem("elsenyor-rutes")):g}addRuta(e){this.rutesArray.mutate(i=>i.push(e))}deleteRutaFromArr(e){this.rutesArray.update(i=>[...i.filter(o=>o.name!==e)])}deleteAllRutes(){this.rutesArray.update(e=>[]),localStorage.removeItem("elsenyor-rutes")}modifyRutaOfArr(e,i){const o=this.rutesArray().findIndex(r=>r.name==i);this.rutesArray.mutate(r=>r[o]=e)}changeFav(e,i){this.deleteRutaFromArr(e.name),this.rutesArray.mutate(o=>o.push({name:e.name,coords:e.coords,descripcio:e.descripcio,puntuacio:e.puntuacio,default:e.default,fav:i}))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function _(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.enableAddPuntsOfRutaArray())}),t._uU(1," Afegeix una ruta "),t.qZA()}}function h(n,a){if(1&n&&(t.ynx(0),t.TgZ(1,"div"),t._uU(2),t.qZA(),t.BQk()),2&n){const e=a.$implicit;t.xp6(2),t.AsE("",e.lat,", ",e.lng,"")}}function x(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",0),t._uU(2,"Punts afegits (m\xednim 2):"),t.qZA(),t.YNc(3,h,3,2,"ng-container",8),t.TgZ(4,"form",12),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.submitForm())}),t.TgZ(5,"div")(6,"label",13),t._uU(7,"Nom"),t.qZA(),t._UZ(8,"input",14),t.TgZ(9,"label",15),t._uU(10,"Puntuaci\xf3"),t.qZA(),t._UZ(11,"input",16),t.qZA(),t.TgZ(12,"div")(13,"label",17),t._uU(14,"Descripci\xf3"),t.qZA(),t._UZ(15,"input",18),t.TgZ(16,"label",19),t._uU(17,"Favorit"),t.qZA(),t._UZ(18,"input",20),t.qZA(),t.TgZ(19,"button",21),t._uU(20," Crea la ruta "),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.currentCoords),t.xp6(1),t.Q6J("formGroup",e.rutaForm),t.xp6(4),t.ekj("is-invalid",e.rutaForm.get("inputNom").invalid&&e.rutaForm.get("inputNom").touched),t.xp6(3),t.ekj("is-invalid",e.rutaForm.get("inputPuntuacio").invalid&&e.rutaForm.get("inputPuntuacio").touched),t.xp6(4),t.ekj("is-invalid",e.rutaForm.get("inputPuntuacio").invalid&&e.rutaForm.get("inputPuntuacio").touched),t.xp6(4),t.Q6J("disabled",2>e.currentCoords.length)}}function y(n,a){if(1&n&&(t.ynx(0),t.TgZ(1,"div",34)(2,"b"),t._uU(3),t.qZA()(),t.TgZ(4,"div",2)(5,"b"),t._uU(6,"Descripci\xf3"),t.qZA(),t._uU(7),t.qZA(),t.TgZ(8,"div",2)(9,"b"),t._uU(10,"Puntuaci\xf3"),t.qZA(),t._uU(11),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(4),t.hij(": ",e.descripcio," "),t.xp6(4),t.hij(": ",e.puntuacio," ")}}function v(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",12),t.NdJ("ngSubmit",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.modifyRuta(o))}),t.TgZ(1,"div")(2,"label",35),t._uU(3,"Nom"),t.qZA(),t._UZ(4,"input",36),t.TgZ(5,"label",15),t._uU(6,"Puntuaci\xf3"),t.qZA(),t._UZ(7,"input",37),t.qZA(),t.TgZ(8,"div")(9,"label",38),t._uU(10,"Descripci\xf3"),t.qZA(),t._UZ(11,"input",39),t.qZA(),t.TgZ(12,"button",21),t._uU(13," Envia "),t.qZA()()}if(2&n){const e=t.oxw(2);t.Q6J("formGroup",e.modifyRutaForm),t.xp6(4),t.ekj("is-invalid",e.modifyRutaForm.get("inputNom2").invalid&&e.modifyRutaForm.get("inputNom2").touched),t.xp6(3),t.ekj("is-invalid",e.modifyRutaForm.get("inputPuntuacio2").invalid&&e.modifyRutaForm.get("inputPuntuacio2").touched),t.xp6(4),t.ekj("is-invalid",e.modifyRutaForm.get("inputPuntuacio2").invalid&&e.modifyRutaForm.get("inputPuntuacio2").touched),t.xp6(1),t.Q6J("disabled",!e.modifyRutaForm.valid)}}function R(n,a){1&n&&(t.TgZ(0,"small",40),t._uU(1,"Ruta per defecte"),t.qZA())}function b(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"i",41),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.changeFav(o,!1))}),t.qZA()}}function A(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"i",42),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.changeFav(o,!0))}),t.qZA()}}function F(n,a){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",22)(2,"div",23)(3,"img",24),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.centerMap(r.coords[0].lat,r.coords[0].lng))}),t.qZA(),t.TgZ(4,"div",25),t.YNc(5,y,12,3,"ng-container",26),t.YNc(6,v,14,8,"ng-template",null,27,t.W1O),t.qZA(),t.YNc(8,R,2,0,"small",28),t.YNc(9,b,1,0,"i",29),t.YNc(10,A,1,0,"i",30),t.TgZ(11,"div",31)(12,"button",32),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.showModifyRutaForm(r))}),t._uU(13," Modifica "),t.qZA(),t.TgZ(14,"button",33),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.deleteRuta(r.name))}),t._uU(15," Elimina "),t.qZA()()()(),t.BQk()}if(2&n){const e=a.$implicit,i=a.index,o=t.MAs(7),r=t.oxw();t.xp6(2),t.Q6J("id","card-"+i),t.xp6(1),t.Q6J("src","https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/pin-s("+e.coords[0].lng+","+e.coords[0].lat+")/"+e.coords[0].lng+","+e.coords[0].lat+",14/500x300?access_token=pk.eyJ1Ijoicm9nZXItbWlyLW1pbiIsImEiOiJjbGoxbmR5cmgwc2EzM25veG12MmpsMzFsIn0._AGFhRr_UiAPltvxQ2ztiQ",t.LSH),t.xp6(2),t.Q6J("ngIf",r.selectedToModifyRouteName!=e.name)("ngIfElse",o),t.xp6(3),t.Q6J("ngIf",1==e.default),t.xp6(1),t.Q6J("ngIf",1==e.fav&&0==e.default),t.xp6(1),t.Q6J("ngIf",0==e.fav&&0==e.default)}}let C=(()=>{class n{constructor(e,i,o,r){this.fb=e,this.rutesService=i,this.renderer=o,this.el=r,this.rutesArray=(0,t.tdS)([]),this.showArray=!1,this.currentCoords=[],this.resetMapAfterRutesArrayUpdate=(0,t.cEC)(()=>{this.rutesArray()&&this.map&&(this.map.eachLayer(s=>{this.map.removeLayer(s)}),(0,l._6)(this.map),this.addRutesToMap())}),this.rutesArray=this.rutesService.rutesArray,this.rutaForm=this.fb.group({inputNom:["",[u.kI.required]],inputPuntuacio:[0,[u.kI.required]],inputDescripcio:["",[u.kI.required]],inputFav:!1}),this.modifyRutaForm=this.fb.group({inputNom2:["",[u.kI.required]],inputPuntuacio2:[0,[u.kI.required]],inputDescripcio2:["",[u.kI.required]],inputFav2:!1})}submitForm(){const e=this.rutaForm.value;this.rutesService.addRuta({name:e.inputNom,coords:this.currentCoords,descripcio:e.inputDescripcio,puntuacio:e.inputPuntuacio,default:!1,fav:e.inputFav}),this.showArray=!1}ngOnInit(){console.log("Map-rutes component initilized")}ngAfterViewInit(){this.map=(0,l.ip)("map"),(0,l._6)(this.map),this.addRutesToMap(),this.map.on("click",e=>{const i=e.latlng.lat,o=e.latlng.lng;if(1==this.showArray){this.currentCoords.push({lat:i,lng:o});let r=(0,d.marker)([i,o]).addTo(this.map);r.on("click",()=>{this.map.removeLayer(r),this.currentCoords=[...this.currentCoords.filter(s=>s.lat!==i&&s.lng!==o)]})}})}addRutesToMap(){this.rutesArray().map(e=>{const i=(0,d.polyline)(e.coords,{color:this.getRandomColor()}).bindPopup(`${e.name}`).addTo(this.map);i.on("click",()=>i.openPopup()),i.on("popupopen",()=>this.highlightCard({selectedRuta:e,highlight:!0})),i.on("popupclose",()=>this.highlightCard({selectedRuta:e,highlight:!1}))})}enableAddPuntsOfRutaArray(){this.showArray=!0}deleteRuta(e){this.rutesService.deleteRutaFromArr(e)}deleteAllRutes(){this.rutesService.deleteAllRutes()}changeFav(e,i){this.rutesService.changeFav(e,i)}showModifyRutaForm(e){this.selectedToModifyRouteName=e.name,this.modifyRutaForm.patchValue({inputNom2:e.name,inputPuntuacio2:e.puntuacio,inputDescripcio2:e.descripcio})}modifyRuta(e){const i=this.modifyRutaForm.value;this.rutesService.modifyRutaOfArr({name:i.inputNom2,coords:e.coords,descripcio:i.inputDescripcio2,puntuacio:i.inputPuntuacio2,default:e.default,fav:e.fav},e.name),this.modifyRutaForm.reset(),this.selectedToModifyRouteName=void 0}highlightCard(e){this.rutesArray().forEach((i,o)=>{e.selectedRuta.name==i.name&&e.selectedRuta.coords[0].lng==i.coords[0].lng&&e.selectedRuta.coords[0].lat==i.coords[0].lat&&(this.highlightedCard=this.el.nativeElement.querySelector(`#card-${o}`),this.renderer.setStyle(this.highlightedCard,"border",1==e.highlight?"1px solid black":"none"))})}getRandomColor(){const e=10*Math.random();return e>9?"blue":e>8?"purple":e>7?"red":e>6?"pink":e>5?"brown":e>4?"green":e>3?"black":e>2?"orange":e>2?"grey":"yellow"}centerMap(e,i){(0,l.up)(e,i,this.map)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.qu),t.Y36(f),t.Y36(t.Qsj),t.Y36(t.SBq))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-map-rutes"]],standalone:!0,features:[t.jDz],decls:18,vars:3,consts:[[1,"fw-bold"],[1,"mb-5"],[1,"text-crimson"],["id","map",1,"mb-3"],["class","btn btn-dark",3,"click",4,"ngIf"],["class","my-4 text-crimson",4,"ngIf"],[1,"punts-wrapper"],[1,"row","g-0",2,"margin","0 -16px 0 -16px"],[4,"ngFor","ngForOf"],[1,"btn","btn-danger","mx-auto","mt-4","text-crimson",2,"max-width","40%",3,"click"],[1,"btn","btn-dark",3,"click"],[1,"my-4","text-crimson"],[3,"formGroup","ngSubmit"],["for","nom",1,"me-2"],["id","nom","type","text","placeholder","nom","formControlName","inputNom",1,"me-2","me-md-3","mb-3"],["for","puntuaci\xf3",1,"me-2"],["id","puntuaci\xf3","type","number","formControlName","inputPuntuacio",1,"me-2","me-md-3","mb-3"],["for","descripci\xf3",1,"me-2"],["id","descripci\xf3","tpye","text","formControlName","inputDescripcio",1,"me-2","me-md-3","mb-3"],["for","fav",1,"me-2"],["id","fav","type","checkbox","formControlName","inputFav",1,"me-2","me-md-3","mb-3"],["type","submit",1,"btn","btn-dark",3,"disabled"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","p-3"],[1,"card","text-center","h-100",2,"position","relative",3,"id"],["alt","mapet",1,"cursor-pointer",3,"src","click"],[1,"card-body"],[4,"ngIf","ngIfElse"],["modifyForm",""],["style","position: absolute; top: 12px; right: 12px",4,"ngIf"],["class","fa-solid fa-star","style","position: absolute; top: 12px; right: 12px",3,"click",4,"ngIf"],["class","fa-regular fa-star","style","position: absolute; top: 12px; right: 12px",3,"click",4,"ngIf"],[1,"card-footer"],[1,"btn","btn-outline-dark","text-crimson","me-2",3,"click"],[1,"btn","btn-outline-danger","text-crimson",3,"click"],[1,""],["for","nom2",1,"me-2"],["id","nom2","type","text","placeholder","nom","formControlName","inputNom2",1,"me-2","me-md-3","mb-3"],["id","puntuaci\xf3","type","number","formControlName","inputPuntuacio2",1,"me-2","me-md-3","mb-3"],["for","descripci\xf32",1,"me-2"],["id","descripci\xf32","tpye","text","formControlName","inputDescripcio2",1,"me-2","me-md-3","mb-3"],[2,"position","absolute","top","12px","right","12px"],[1,"fa-solid","fa-star",2,"position","absolute","top","12px","right","12px",3,"click"],[1,"fa-regular","fa-star",2,"position","absolute","top","12px","right","12px",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Les meves rutes"),t.qZA(),t.TgZ(2,"section",1)(3,"h3",2),t._uU(4,"Mapa de rutes guardades"),t.qZA(),t.TgZ(5,"p",2),t._uU(6,' Clica el bot\xf3 "Afegeix una ruta", i a continuaci\xf3 clica al mapa als punts de la ruta, per ordre. Posa un punt per cada canvi de direcci\xf3 de la ruta. Completa la informaci\xf3 de la ruta que apareix sota el mapa i clica "Crea la ruta". Veur\xe0s que es dibuixa la ruta al mapa i que s\'afegeix la targeta de la nova ruta a la col\xb7lecci\xf3 de baix. Les dues primeres targetes hi s\xf3n per defecte, les pots eliminar. '),t.qZA(),t._UZ(7,"div",3),t.YNc(8,_,2,0,"button",4),t.YNc(9,x,21,9,"div",5),t.qZA(),t.TgZ(10,"section")(11,"div",6)(12,"h3",2),t._uU(13,"Col\xb7lecci\xf3 de rutes guardades"),t.qZA(),t.TgZ(14,"div",7),t.YNc(15,F,16,7,"ng-container",8),t.qZA(),t.TgZ(16,"button",9),t.NdJ("click",function(){return i.deleteAllRutes()}),t._uU(17," Eliminar totes les rutes "),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("ngIf",0==i.showArray),t.xp6(1),t.Q6J("ngIf",1==i.showArray),t.xp6(6),t.Q6J("ngForOf",i.rutesArray()))},dependencies:[p.ez,p.sg,p.O5,u.UX,u._Y,u.Fj,u.wV,u.Wl,u.JJ,u.JL,u.sg,u.u],styles:["#map[_ngcontent-%COMP%]{height:600px}"]}),n})();const Z=[{path:"",providers:[f],component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-rutes"]],standalone:!0,features:[t.jDz],decls:1,vars:0,template:function(e,i){1&e&&t._UZ(0,"app-map-rutes")},dependencies:[p.ez,C]}),n})()}]}}]);